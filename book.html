<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reserve Your Spot | BotWeb</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- NAVBAR: copied exactly from index.html -->
  <nav class="navbar">
    <div class="nav-content">
      <a href="index.html" class="nav-logo">BotWeb</a>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="about.html" class="nav-link">About</a>
        <a href="services.html" class="nav-link">Services</a>
        <a href="book.html" class="nav-link active">Contact</a>
        <a href="donate.html" class="nav-btn">Donate Now</a>
      </div>
    </div>
  </nav>

  <div class="book-section">
    <div class="book-container">
      <div class="book-title">Reserve Your Spot</div>
      <div class="spots-counter" id="spotsCounter">
        Spots Left: <span id="spotsLeft">3</span> / 3
      </div>
      <form
        class="book-form"
        id="bookForm"
        action="https://formspree.io/f/movwbybe"
        method="POST"
        autocomplete="off"
      >
        <label for="email">Your email:</label>
        <input type="email" name="email" id="email" required>
        <label for="message">Your message:</label>
        <textarea name="message" id="message" required></textarea>
        <label>Type</label>
        <div class="type-selector-group">
          <div class="type-selector">
            <input type="radio" name="orgType" id="type-business" value="Business" class="type-radio" required>
            <label for="type-business" class="type-label">Business</label>
          </div>
          <div class="type-selector">
            <input type="radio" name="orgType" id="type-charity" value="Charity" class="type-radio" required>
            <label for="type-charity" class="type-label">Charity</label>
          </div>
        </div>
        <label for="orgName">Business/Charity Name</label>
        <input type="text" id="orgName" name="orgName" placeholder="e.g. Helping Hands" required>
        <label for="yourName">Your Name</label>
        <input type="text" id="yourName" name="yourName" placeholder="Your name" required>
        <label for="website">Current Website (optional)</label>
        <input type="text" id="website" name="website" placeholder="https://yourdomain.com">
        <label for="info">Tell us about your mission</label>
        <textarea id="info" name="info" rows="3" placeholder="Describe your business/charity and what you hope to achieve..." required></textarea>
        <button type="submit" id="submitBtn">Reserve Spot</button>
      </form>
      <div class="book-success" id="bookSuccess"></div>
    </div>
  </div>
  <script>
    // --- For a global counter you need a backend API ---
    const MAX_SPOTS = 3;
    const SPOTS_API_URL = "/api/spots";

    async function getSpotsLeft() {
      try {
        const res = await fetch(SPOTS_API_URL + "?t=" + Date.now());
        if (!res.ok) throw new Error();
        const data = await res.json();
        return data.spots ?? MAX_SPOTS;
      } catch {
        return MAX_SPOTS;
      }
    }

    async function updateCounter() {
      const left = await getSpotsLeft();
      document.getElementById('spotsLeft').textContent = left;
      const form = document.getElementById('bookForm');
      if (left <= 0) {
        document.getElementById('spotsCounter').innerHTML = 'All spots are <span class="spot-full">FULL!</span>';
        form.querySelectorAll('input, textarea, select, button').forEach(e => e.disabled = true);
      } else {
        document.getElementById('spotsCounter').innerHTML = `Spots Left: <span id="spotsLeft">${left}</span> / ${MAX_SPOTS}`;
        form.querySelectorAll('input, textarea, select, button').forEach(e => e.disabled = false);
      }
    }
    updateCounter();

    document.getElementById('bookForm').addEventListener('submit', async function(e) {
      fetch("/api/spots/decrement", {method:"POST"});
      setTimeout(updateCounter, 1500);
    });
  </script>
</body>
</html>
